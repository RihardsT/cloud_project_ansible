- name: Add some aliases
  copy:
    dest: "/home/{{ item }}/.bash_aliases"
    content: |
      alias nerk="sudo nerdctl -n k8s.io"
      alias nerdctl="sudo nerdctl"
      alias dfsda1="df -h /dev/sda1"
      alias aptupgr="sudo apt update; sudo apt upgrade"
  with_items: "{{ app_user }}"

- name: Autocompletions
  become: yes
  ansible.builtin.blockinfile:
    path: "/home/{{ item }}/.bashrc"
    block: |
      source <(/usr/local/bin/nerdctl completion bash)
      source <(kubectl completion bash)
  with_items: "{{ app_user }}"


- name: Add markers for aliases locally
  when: cloud == "oracle"
  become_user: rihards
  delegate_to: localhost
  ansible.builtin.blockinfile:
    path: "/home/rihards/.bash_aliases"
    block: |
      #OCI_ALIASES
      #END_OCI_ALIASES

- name: Add some aliases locally
  when: cloud == "oracle"
  become_user: rihards
  delegate_to: localhost
  ansible.builtin.shell: |
    echo "Hello"
    echo "Ansible command" > ~/ansible_command
    ex ~/.bash_aliases << EOF
    /#OCI_ALIASES/,/#END_OCI_ALIASES/c
    #OCI_ALIASES
    alias oc1_tf="terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ apply"
    # SSH
    alias oc1_ssh="ssh $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip) -o StrictHostKeyChecking=no -o 'UserKnownHostsFile=/dev/null'"
    alias oc2_ssh="ssh -o StrictHostKeyChecking=no -o 'UserKnownHostsFile=/dev/null' -A -J $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip) $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_2)"
    alias oc3_ssh="ssh -o StrictHostKeyChecking=no -o 'UserKnownHostsFile=/dev/null' -A -J $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip) $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_3)"
    # Ansible
    alias oc1_ansible="ansible-playbook -i $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip), \
      -e node_ip_address=$(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip) \
      -u rihards --diff -e ansible_python_interpreter=/usr/bin/python3 -e ansible_port=22 \
      /home/rihards/Code/cloud_project/cloud_project_ansible/oc1.yml"
    alias oc2_ansible="ansible-playbook -i $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_2), \
      -e node_ip_address=$(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_2) \
      --ssh-common-args=\"-A -o StrictHostKeyChecking=no -o 'UserKnownHostsFile=/dev/null' -o ProxyCommand='ssh -W %h:22 -q rudenspavasaris.id.lv'\" \
      -u ubuntu --diff -e ansible_python_interpreter=/usr/bin/python3 -e ansible_port=22 \
      /home/rihards/Code/cloud_project/cloud_project_ansible/oc0.yml"
    alias oc3_ansible="ansible-playbook -i $(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_3), \
      -e node_ip_address=$(terraform -chdir=/home/rihards/Code/cloud_project/cloud_project_terraform_oracle/ output -raw ip_3) \
      --ssh-common-args=\"-A -o StrictHostKeyChecking=no -o 'UserKnownHostsFile=/dev/null' -o ProxyCommand='ssh -W %h:22 -q rudenspavasaris.id.lv'\" \
      -u ubuntu --diff -e ansible_python_interpreter=/usr/bin/python3 -e ansible_port=22 \
      /home/rihards/Code/cloud_project/cloud_project_ansible/oc0.yml"
    #END_OCI_ALIASES
    .
    w!
    q
    EOF
